{% extends "base.html" %}
{% load static %}

{% block title %}Bus Checker{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="{% static 'buschecker/css/buschecker.css' %}">
{% endblock %}

{% block content %}
<div id="searchOptions" class="text-center">
    <form method="post">
        {% csrf_token %}

        <div id="toFromSelection">
            <input type="radio" id="toCity" name="directionChoice" value="to_city">
            <label for="toCity">To City</label>

            <input type="radio" id="fromCity" name="directionChoice" value="from_city">
            <label for="fromCity">From City</label>
        </div>

        <div id="areaInput">
            <label for="areaChoice">Enter area/destination</label>
            <input
                type="text"
                id="areaChoice"
                name="areaChoice"
                placeholder="eg. Eglinton, Culmore"
            >
        </div>

        <div>
            <button type="submit">Search</button>
        </div>
    </form>
</div>

<hr>

{% if stops %}
    <div id="map" style="height: 500px;"></div>
{% else %}
    <p class="text-center">No stops to display</p>
{% endif %}

<hr>

<div id="bus-results"></div>

<script>
    const stops = [
        {% for stop in stops %}
        {
            id: {{ stop.id }},
            name: "{{ stop.name|escapejs }}",
            latitude: {{ stop.latitude }},
            longitude: {{ stop.longitude }}
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];

    function renderBusTimes(times) {
        const resultsDiv = document.getElementById("bus-results");
        resultsDiv.innerHTML = "";

        if (!times || times.length === 0) {
            resultsDiv.innerHTML = "<p>No scheduled buses.</p>";
            return;
        }

        const ul = document.createElement("ul");
        times.forEach(bus => {
            const li = document.createElement("li");
            li.textContent = `${bus.service} â€“ Due at ${bus.time}`;
            ul.appendChild(li);
        });

        resultsDiv.appendChild(ul);
    }
</script>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{% static 'buschecker/js/buschecker_map.js' %}"></script>
{% endblock %}
