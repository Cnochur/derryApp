{% extends "base.html" %}
{% load static %}

{% block title %}Bus Checker – YerLocal{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="{% static 'buschecker/css/buschecker.css' %}">
{% endblock %}

{% block content %}
<div class="container py-4">

    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="card-title mb-3">Find your bus</h5>

            <form method="post" class="row gy-3">
                {% csrf_token %}

                <div class="col-12">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio"
                               name="directionChoice" id="toCity" value="to_city">
                        <label class="form-check-label" for="toCity">To City</label>
                    </div>

                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio"
                               name="directionChoice" id="fromCity" value="from_city">
                        <label class="form-check-label" for="fromCity">From City</label>
                    </div>
                </div>

                <div class="col-md-8">
                    <input
                        type="text"
                        class="form-control"
                        name="areaChoice"
                        placeholder="Enter area or destination"
                    >
                </div>

                <div class="col-md-4 d-grid">
                    <button type="submit" class="btn btn-primary">
                        Search Stops
                    </button>
                </div>
            </form>
        </div>
    </div>

    {% if stops %}
        <div class="card shadow-sm mb-4">
            <div class="card-body p-0">
                <div id="map" style="height: 400px;"></div>
            </div>
        </div>
    {% endif %}

    <div id="bus-results" class="mt-3"></div>

</div>

<script>
    const stops = [
        {% for stop in stops %}
        {
            id: {{ stop.id }},
            name: "{{ stop.name|escapejs }}",
            latitude: {{ stop.latitude }},
            longitude: {{ stop.longitude }}
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];

    function renderBusTimes(times) {
        const results = document.getElementById("bus-results");
        results.innerHTML = "";

        if (!times || times.length === 0) {
            results.innerHTML =
                `<div class="alert alert-info">No scheduled buses.</div>`;
            return;
        }

        const list = document.createElement("ul");
        list.className = "list-group";

        times.forEach(bus => {
            const item = document.createElement("li");
            item.className = "list-group-item";
            item.textContent = `${bus.service} – Due at ${bus.time}`;
            list.appendChild(item);
        });

        results.appendChild(list);
    }
</script>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{% static 'buschecker/js/buschecker_map.js' %}"></script>
{% endblock %}
